{% extends "web/base.html" %}

{% block title %}AI Daily Digest — {{ date }}{% endblock %}

{% block extra_css %}
  .section-title {
    font-size: 13px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 1px;
    color: var(--primary);
    border-bottom: 2px solid var(--border);
    padding-bottom: 8px; margin: 24px 0 16px 0;
  }
  .event { margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid #f0f0f5; }
  .event:last-child { border-bottom: none; }
  .event-title { font-size: 17px; font-weight: 600; margin: 0 0 6px 0; }
  .event-company { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
  .event-body { font-size: 14px; }
  .event-body ul { padding-left: 20px; margin: 4px 0; }
  .event-body li { margin-bottom: 4px; }
  .event-sources { font-size: 12px; color: #888; margin-top: 8px; }
  .overview { background: #f0f0ff; border-left: 4px solid var(--primary); padding: 16px; border-radius: 0 8px 8px 0; margin-bottom: 20px; }
  .radar-card { background: #f8f9ff; border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-bottom: 12px; }
  .skim-item { padding: 4px 0; font-size: 14px; }
{% endblock %}

{% block content %}
  <h2>{{ date }}</h2>

  {% if overview %}
  <div class="overview">{{ overview }}</div>
  {% endif %}

  <div class="card">
    {% if sections.top5 %}
    <div class="section-title">[1] Top 5 — High Impact</div>
    {% for event in sections.top5 %}
    <div class="event">
      <div class="event-title">{{ loop.index }}. {{ event.title }}</div>
      <div>
        <span class="badge badge-{{ event.severity|lower }}">{{ event.severity }}</span>
        {% for cat in event.categories[:2] %}
        <span class="badge badge-cat">{{ cat }}</span>
        {% endfor %}
      </div>
      <div class="event-company">{{ event.company_name }}{% if event.product_line %} / {{ event.product_line }}{% endif %}</div>
      <div class="event-body">
        {% if event.what_changed %}
        <strong>What changed:</strong>
        <ul>
          {% for item in event.what_changed %}
          <li>{{ item.fact if item is mapping else item }}{% if item is mapping and item.citation_url %} <a href="{{ item.citation_url }}">[source]</a>{% endif %}</li>
          {% endfor %}
        </ul>
        {% endif %}
        {% if event.why_it_matters %}
        <p><strong>Why it matters:</strong> {{ event.why_it_matters }}</p>
        {% endif %}
        {% if event.action_items %}
        <strong>Action items:</strong>
        <ul>
          {% for action in event.action_items %}
          <li>{{ action }}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
      {% if event.citations %}
      <div class="event-sources">
        Sources: {% for url in event.citations %}<a href="{{ url }}">{{ url|truncate(50) }}</a>{% if not loop.last %}, {% endif %}{% endfor %}
        | {{ event.confidence }} | Tier {{ event.trust_tier }}
      </div>
      {% endif %}
    </div>
    {% endfor %}
    {% endif %}

    {% if sections.developer %}
    <div class="section-title">[2] Developer Changes</div>
    {% for event in sections.developer %}
    <div class="event">
      <div class="event-title">{{ event.title }}</div>
      <div>
        <span class="badge badge-{{ event.severity|lower }}">{{ event.severity }}</span>
        {% for cat in event.categories[:2] %}
        <span class="badge badge-cat">{{ cat }}</span>
        {% endfor %}
      </div>
      <div class="event-company">{{ event.company_name }}</div>
      <div class="event-body">{% if event.summary_short %}{{ event.summary_short }}{% endif %}</div>
    </div>
    {% endfor %}
    {% endif %}

    {% if sections.models %}
    <div class="section-title">[3] Models &amp; Capabilities</div>
    {% for event in sections.models %}
    <div class="event">
      <div class="event-title">{{ event.title }}</div>
      <div>
        <span class="badge badge-{{ event.severity|lower }}">{{ event.severity }}</span>
        {% for cat in event.categories[:2] %}
        <span class="badge badge-cat">{{ cat }}</span>
        {% endfor %}
      </div>
      <div class="event-body">{% if event.summary_short %}{{ event.summary_short }}{% endif %}</div>
    </div>
    {% endfor %}
    {% endif %}

    {% if sections.pricing %}
    <div class="section-title">[4] Pricing &amp; Limits</div>
    {% for event in sections.pricing %}
    <div class="event">
      <div class="event-title">{{ event.title }}</div>
      <div class="event-body">{% if event.summary_short %}{{ event.summary_short }}{% endif %}</div>
    </div>
    {% endfor %}
    {% endif %}

    {% if sections.incidents %}
    <div class="section-title">[5] Incidents &amp; Reliability</div>
    {% for event in sections.incidents %}
    <div class="event">
      <div class="event-title">{{ event.title }}</div>
      <div class="event-body">{% if event.summary_short %}{{ event.summary_short }}{% endif %}</div>
    </div>
    {% endfor %}
    {% endif %}

    {% if sections.radar %}
    <div class="section-title">[6] Community Radar</div>
    {% for event in sections.radar %}
    <div class="radar-card">
      <h4>{{ event.title }}</h4>
      <p>{% if event.summary_short %}{{ event.summary_short }}{% endif %}</p>
      {% if event.citations %}
      <p>Try it: <a href="{{ event.citations[0] }}">{{ event.citations[0] }}</a></p>
      {% endif %}
    </div>
    {% endfor %}
    {% endif %}

    {% if sections.everything_else %}
    <div class="section-title">[7] Everything Else</div>
    {% for event in sections.everything_else %}
    <div class="skim-item">
      - {{ event.title }}
      <span class="badge badge-{{ event.severity|lower }}">{{ event.severity }}</span>
      {% if event.citations %} — <a href="{{ event.citations[0] }}">source</a>{% endif %}
    </div>
    {% endfor %}
    {% endif %}
  </div>
{% endblock %}
